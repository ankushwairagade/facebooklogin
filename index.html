<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WhatsApp Signup & Send</title>
  <style>
    body { font:16px Arial; padding:20px }
    button { margin:5px; padding:10px 20px }
    #status { margin-top:20px; white-space:pre-wrap; background:#f9f9f9; padding:10px; border:1px solid #ddd }
  </style>
</head>
<body>
  <h1>WhatsApp Embedded Signup</h1>
  <button id="signup">Start Signup</button>
  <button id="send" disabled>Send Message</button>
  <div id="status"></div>

  <!-- FB SDK -->
  <script>
    function log(m){console.log(m);status.textContent+=m+"\n"}
    window.fbAsyncInit=function(){FB.init({appId:"665303969425082",autoLogAppEvents:true,xfbml:true,version:"v22.0"});log("‚úÖ FB SDK ready")};
  </script>
  <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>

  <script>
    const CONFIG_ID="9698426723575894", BACKEND="https://facebooklogin-phi.vercel.app", TO="+917276517716";
    const btnSignup=document.getElementById("signup"), btnSend=document.getElementById("send"), status=document.getElementById("status");
    let code, phoneId;

    btnSignup.onclick=()=>{
      btnSignup.disabled=true; log("üîÑ Launching signup");
      FB.ui({method:"whatsapp_business_signup",config_id:CONFIG_ID,response_type:"code",redirect_uri:location.origin},r=>{
        if(!r||!r.code||!r.phone_number_id){log("‚ùå Signup failed");btnSignup.disabled=false;return}
        code=r.code;phoneId=r.phone_number_id;log(`‚úÖ code:${code}`);log(`‚úÖ phoneId:${phoneId}`);
        btnSend.disabled=false;btnSignup.disabled=false;
      });
    };

    btnSend.onclick=async()=>{
      btnSend.disabled=true;log("üîÑ Sending message");
      try{
        const res=await fetch(BACKEND+"/send_message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code,phone_number_id:phoneId})});
        const d=await res.json();log(`‚¨ÖÔ∏è ${res.status}`);
        if(!res.ok)throw new Error(d.error||"send error");
        log(`‚úÖ Sent:${JSON.stringify(d)}`)
      }catch(e){log("‚ùå "+e.message)}finally{btnSend.disabled=false}
    };
  </script>
</body>
</html>